const c="https://bas.customeros.ai";async function d(){try{const s=await new Promise((o,r)=>{chrome.tabs.query({},i=>{const a=i.find(t=>t.url&&(t.url.includes("localhost")||t.url.includes("customeros")));a?o(a):r(new Error("No app.customeros.ai tab found"))})});await new Promise((o,r)=>{chrome.scripting.executeScript({target:{tabId:s.id},files:["contentScript.js"]},()=>{chrome.runtime.lastError?r(new Error(`Error injecting content script: ${chrome.runtime.lastError.message}`)):o()})});const e=await new Promise(o=>{const r=i=>{i.action==="COS_SESSION_DATA"&&(chrome.runtime.onMessage.removeListener(r),o({email:i.email,apiKey:i.apiKey}))};chrome.runtime.onMessage.addListener(r)}),m=e==null?void 0:e.email,u=e==null?void 0:e.apiKey;if(!m||!u){console.error("Error: Could not retrieve userNameCustomerOs or apiKey from session");return}const n=(await new Promise((o,r)=>{chrome.cookies.getAll({domain:".linkedin.com"},i=>{chrome.runtime.lastError?r(new Error(`Error retrieving cookies: ${chrome.runtime.lastError.message}`)):o(i)})})).find(o=>o.name==="li_at");if(!n)return;const l=navigator.userAgent||"unknown";chrome.storage.local.get(["storedCookies"],async o=>{const r=o.storedCookies;let i=null;if(r&&(i=r),i&&i.value===n.value)return;const t=await(await fetch(`${c}/browser/config`,{headers:{"x-openline-api-key":`${e.apiKey}`,"x-openline-username":`${e.email}`},method:"GET"})).json();t.data.cookies&&t.data.cookies.length>0?t.data.cookies!==n.value?(console.log("Different cookie detected"),await fetch(`${c}/browser/config`,{method:"PATCH",headers:{"Content-Type":"application/json","x-openline-api-key":`${e.apiKey}`,"x-openline-username":`${e.email}`},body:JSON.stringify({cookies:`[{"name":"li_at","value":"${n==null?void 0:n.value}","domain":"www.linkedin.com","path":"/","secure":true,"httpOnly":true,"sameSite":"Lax"}]`,userAgent:l})})):console.log("Cookie is the same"):(console.log("No previous cookies, creating new record"),await fetch(`${c}/browser/config`,{method:"POST",headers:{"Content-Type":"application/json","x-openline-api-key":`${e.apiKey}`,"x-openline-username":`${e.email}`},body:JSON.stringify({cookies:`[{"name":"li_at","value":"${n==null?void 0:n.value}","domain":"www.linkedin.com","path":"/","secure":true,"httpOnly":true,"sameSite":"Lax"}]`,userAgent:l})})),chrome.storage.local.set({storedCookies:n})})}catch(s){console.error("Error in getCookiesFromLinkedInTab:",s)}}chrome.alarms.create("checkLinkedInCookies",{periodInMinutes:.1});chrome.alarms.onAlarm.addListener(s=>{s.name==="checkLinkedInCookies"&&d()});
